# RTT 图表智能启用功能

## 功能概述

新增的**智能启用**功能可以自动检测 RTT 数据格式并配置图表，无需手动配置。

## 使用方法

### 1. 一键启用（推荐）

1. 启动 RTT 并接收一些数据（至少 10-20 行）
2. 点击工具栏的 **✨ 智能启用** 按钮
3. 系统会自动：
   - 分析最近的数据格式
   - 配置解析规则
   - 创建数据系列
   - 切换到分屏视图
   - 开始显示图表

### 2. 手动配置（高级）

如果智能检测失败或需要自定义配置，点击 **⚙️ 配置图表** 按钮进行手动配置。

## 支持的数据格式

### 1. 单数值格式（最常见）

**示例数据：**
```
-86
-85
-84
98
97
```

**自动配置：**
- 解析模式：分隔符
- 字段：`value`（索引 0）
- 系列：`数值`（蓝色）

### 2. CSV 格式（逗号/制表符/空格分隔）

**示例数据：**
```
25.5,60.2,1013.25
25.6,60.1,1013.30
25.7,60.0,1013.28
```

**自动配置：**
- 解析模式：分隔符
- 字段：`field1`, `field2`, `field3`
- 系列：自动创建多个系列，不同颜色

### 3. JSON 格式

**示例数据：**
```json
{"temp":25.5,"humi":60.2,"press":1013.25}
{"temp":25.6,"humi":60.1,"press":1013.30}
```

**自动配置：**
- 解析模式：JSON
- 字段：自动提取所有数值字段
- 系列：根据 JSON 键自动创建

## 智能检测逻辑

系统会按以下优先级尝试检测：

1. **单数值检测**（置信度 > 80%）
   - 检查每行是否为纯数值
   - 支持负数和小数

2. **JSON 检测**（置信度 > 80%）
   - 尝试解析 JSON
   - 提取数值类型的字段

3. **CSV 检测**（置信度 > 60%）
   - 尝试多种分隔符（逗号、制表符、空格、分号）
   - 检查字段数是否一致
   - 验证是否为数值

## 优势对比

### 传统手动配置流程：
1. ✅ 启用图表功能
2. ✅ 选择解析模式
3. ✅ 配置分隔符
4. ✅ 添加字段（设置索引和名称）
5. ✅ 添加数据系列（设置键名、显示名、颜色）
6. ✅ 确保字段名和系列键名匹配
7. ✅ 保存配置

**总计：7 个步骤，容易出错**

### 智能启用流程：
1. ✅ 点击"智能启用"按钮

**总计：1 个步骤，自动完成**

## 注意事项

1. **数据量要求**：建议至少接收 10-20 行数据后再使用智能启用
2. **置信度阈值**：如果检测置信度低于 50%，会提示手动配置
3. **数据一致性**：确保数据格式一致，否则可能检测失败
4. **重新配置**：可以随时点击"智能启用"重新检测和配置

## 故障排除

### 问题：点击"智能启用"后提示"无法识别数据格式"

**可能原因：**
- 数据格式不一致
- 数据中包含非数值内容
- 数据量太少

**解决方案：**
1. 确保数据格式统一
2. 接收更多数据后重试
3. 使用手动配置

### 问题：图表显示但没有曲线

**可能原因：**
- 数据系列配置错误
- 字段名和系列键名不匹配

**解决方案：**
1. 点击"配置图表"检查配置
2. 确保"基础"标签页中的数据系列键名与"分隔符"标签页中的字段名称一致

## 技术细节

### 检测算法

智能检测使用以下算法：

1. **采样**：取最近 20 行数据作为样本
2. **格式检测**：依次尝试单数值、JSON、CSV 格式
3. **置信度计算**：基于匹配成功率计算置信度
4. **配置生成**：根据检测结果自动生成完整配置

### 代码位置

- 智能检测逻辑：`src/lib/chartAutoConfig.ts`
- 工具栏集成：`src/components/rtt/RttToolbar.tsx`
- 图表配置：`src/lib/chartTypes.ts`

## 未来改进

- [ ] 支持更多数据格式（如 XML、自定义协议）
- [ ] 提供配置模板库
- [ ] 支持配置导入/导出
- [ ] 添加配置预览功能
