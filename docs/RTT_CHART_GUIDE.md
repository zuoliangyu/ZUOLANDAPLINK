# RTT 绘图功能使用指南

## 功能概述

RTT 绘图功能已成功实现基础架构（阶段 1 - MVP），支持：

✅ **视图模式**
- 仅文本：传统的文本日志显示
- 仅图表：全屏图表显示
- 分屏显示：上半部分文本，下半部分图表（可拖动调整比例）

✅ **数据解析方式**
- 正则表达式：使用命名捕获组提取数值
- 分隔符：CSV 格式数据解析
- JSON：自动解析 JSON 格式数据
- 自动模式：按优先级尝试所有解析方式

✅ **图表类型**
- 折线图（Line Chart）
- 柱状图（Bar Chart）
- 散点图（Scatter Chart）

✅ **基础功能**
- 实时数据更新
- 暂停/继续
- 清空数据
- 导出 CSV
- 解析统计

## 快速开始

### 1. 启用图表功能

1. 连接 RTT 并启动
2. 点击工具栏的"配置图表"按钮
3. 在"基础"标签页中，启用"启用图表功能"开关
4. 选择解析模式（建议先使用"自动"模式）
5. 选择图表类型（默认折线图）

### 2. 配置数据解析

#### 方式 A：JSON 格式（最简单）

如果你的目标设备输出 JSON 格式数据：

```json
{"temp":25.5,"humi":60.2,"press":1013.25}
```

配置步骤：
1. 切换到"JSON"标签页
2. 启用"启用 JSON 解析"
3. 留空"JSON 键"字段（自动提取所有数值）
4. 切换到"基础"标签页
5. 添加数据系列：
   - 键名：temp，显示名称：温度，选择颜色
   - 键名：humi，显示名称：湿度，选择颜色
   - 键名：press，显示名称：气压，选择颜色
6. 点击"保存"

#### 方式 B：正则表达式（最灵活）

如果你的目标设备输出自定义格式：

```
temp:25.5 humi:60.2 press:1013.25
```

配置步骤：
1. 切换到"正则"标签页
2. 启用"启用正则解析"
3. 输入正则表达式：
   ```
   temp:(?<temp>\d+\.?\d*) humi:(?<humi>\d+\.?\d*) press:(?<press>\d+\.?\d*)
   ```
4. 切换到"基础"标签页
5. 添加数据系列（同上）
6. 点击"保存"

#### 方式 C：分隔符（CSV 格式）

如果你的目标设备输出 CSV 格式：

```
25.5,60.2,1013.25
```

配置步骤：
1. 切换到"分隔符"标签页
2. 启用"启用分隔符解析"
3. 选择分隔符（逗号）
4. 添加字段：
   - 索引：0，名称：temp
   - 索引：1，名称：humi
   - 索引：2，名称：press
5. 切换到"基础"标签页
6. 添加数据系列（同上）
7. 点击"保存"

### 3. 切换视图模式

工具栏中有三个视图模式按钮：
- 📄 仅文本：专注查看日志
- ⬌ 分屏显示：同时查看日志和图表
- 📊 仅图表：专注查看数据趋势

### 4. 使用图表

- **暂停/继续**：暂停数据更新以便查看
- **清空**：清空所有图表数据
- **导出**：导出图表数据为 CSV 文件
- **拖动分隔条**：在分屏模式下调整文本和图表的比例

## 测试示例

### 示例 1：简单温度监控

目标设备代码（C）：
```c
printf("temp:%.1f\n", temperature);
```

输出示例：
```
temp:25.5
temp:25.6
temp:25.4
```

配置：
- 解析模式：正则表达式
- 正则：`temp:(?<temp>\d+\.?\d*)`
- 数据系列：键名=temp，名称=温度

### 示例 2：多传感器数据

目标设备代码（C）：
```c
printf("{\"temp\":%.1f,\"humi\":%.1f,\"press\":%.2f}\n",
       temperature, humidity, pressure);
```

输出示例：
```json
{"temp":25.5,"humi":60.2,"press":1013.25}
```

配置：
- 解析模式：JSON
- 数据系列：
  - temp → 温度
  - humi → 湿度
  - press → 气压

### 示例 3：CSV 格式

目标设备代码（C）：
```c
printf("%.1f,%.1f,%.2f\n", temperature, humidity, pressure);
```

输出示例：
```
25.5,60.2,1013.25
```

配置：
- 解析模式：分隔符
- 分隔符：逗号
- 字段：索引 0=temp，索引 1=humi，索引 2=press

## 已知限制

1. **最大数据点数**：默认 1000 个，超过后自动删除旧数据
2. **更新频率**：建议不超过 100Hz，过高可能导致界面卡顿
3. **配置持久化**：配置保存在 localStorage，清除浏览器数据会丢失

## 下一步计划

阶段 2 功能（待实现）：
- [ ] 实时预览解析结果
- [ ] 配置模板管理
- [ ] 图表缩放和平移
- [ ] 数据点悬停详情
- [ ] 图例点击切换系列可见性
- [ ] 统计面板（最大值、最小值、平均值）
- [ ] 导出图表图片

## 故障排除

### 问题：图表不显示数据

检查：
1. 是否启用了图表功能？
2. 是否配置了数据系列？
3. 解析模式是否正确？
4. 查看统计信息中的"失败"计数，如果很高说明解析失败

### 问题：解析失败率高

检查：
1. 正则表达式是否正确？使用在线工具测试
2. 分隔符是否匹配？
3. JSON 格式是否有效？
4. 尝试使用"自动"模式

### 问题：图表卡顿

解决：
1. 减少最大数据点数（如 500）
2. 降低目标设备的输出频率
3. 暂停图表更新

## 反馈

如有问题或建议，请在 GitHub 提交 Issue。
