# RTT XY 散点图使用指南

## 功能概述

XY 散点图是一种新的图表模式，允许您使用两列数据分别作为 X 轴和 Y 轴的值，而不是使用数据点索引作为 X 轴。

## 与普通散点图的区别

### 普通散点图
- **X 轴**：数据点索引（0, 1, 2, 3...）
- **Y 轴**：数据值
- **适用场景**：时间序列数据、顺序数据

### XY 散点图
- **X 轴**：实际数据值（如角度、时间、温度等）
- **Y 轴**：对应的数据值
- **适用场景**：相关性分析、参数曲线、李萨如图形等

## 数据格式

### 基本格式（两列）

```
x,y
0,100
1,98
2,95
3,91
```

或使用其他分隔符：

```
10.5    25.3
11.2    26.1
12.0    24.8
```

### 多系列格式（多列）

```
x,y1,y2
0,100,50
1,98,52
2,95,55
```

第一列作为 X 轴，其他列作为不同的 Y 轴系列。

## 使用方法

### 方法 1：智能启用（推荐）

1. 启动 RTT 并接收 XY 格式的数据
2. 点击工具栏的 **✨ 智能启用** 按钮
3. 系统会自动：
   - 检测到 XY 数据格式
   - 配置为 XY 散点图模式
   - 设置 X 轴字段为 "x"
   - 创建 Y 轴系列

### 方法 2：手动配置

1. 点击 **⚙️ 配置图表** 按钮
2. 在"基础"标签页：
   - ✅ 启用图表功能
   - 图表类型：选择 **XY 散点图**
   - X 轴字段：输入 `x`（或您的 X 轴字段名）
   - 添加数据系列：
     - 键名：`y`（或您的 Y 轴字段名）
     - 显示名称：`Y 值`
3. 切换到"分隔符"标签页：
   - ✅ 启用分隔符解析
   - 分隔符：选择合适的分隔符（逗号、空格等）
   - 添加字段：
     - 字段 1：索引 `0`，名称 `x`
     - 字段 2：索引 `1`，名称 `y`
4. 保存配置

## 应用场景示例

### 1. 李萨如图形

**数据格式：**
```c
// 嵌入式代码
for (int i = 0; i < 360; i++) {
    float angle = i * 3.14 / 180.0;
    int x = (int)(sin(angle) * 100);
    int y = (int)(sin(2 * angle) * 100);
    SEGGER_RTT_printf(0, "%d,%d\n", x, y);
}
```

**效果：** 显示经典的李萨如图形（8字形）

### 2. 参数曲线

**数据格式：**
```c
// 螺旋线
for (int t = 0; t < 360; t++) {
    float angle = t * 3.14 / 180.0;
    int x = (int)(t * cos(angle) / 10);
    int y = (int)(t * sin(angle) / 10);
    SEGGER_RTT_printf(0, "%d,%d\n", x, y);
}
```

**效果：** 显示螺旋线

### 3. 传感器相关性分析

**数据格式：**
```c
// 温度 vs 湿度
SEGGER_RTT_printf(0, "%.1f,%.1f\n", temperature, humidity);
```

**效果：** 分析温度和湿度的相关性

### 4. 多系列 XY 图

**数据格式：**
```c
// X, Y1, Y2
for (int i = 0; i < 360; i++) {
    float angle = i * 3.14 / 180.0;
    int x = i;
    int y1 = (int)(sin(angle) * 100);
    int y2 = (int)(cos(angle) * 100);
    SEGGER_RTT_printf(0, "%d,%d,%d\n", x, y1, y2);
}
```

**配置：**
- X 轴字段：`x`
- 系列 1：`y1`（正弦）
- 系列 2：`y2`（余弦）

## 配置选项

### X 轴字段（xAxisField）

指定哪个字段作为 X 轴。例如：
- `x` - 通用 X 轴
- `time` - 时间
- `angle` - 角度
- `temp` - 温度

**重要：** X 轴字段必须与分隔符配置中的字段名称匹配。

### 数据系列

除了 X 轴字段外的其他字段都可以作为 Y 轴系列。每个系列可以：
- 自定义名称
- 选择颜色
- 显示/隐藏

## 智能检测逻辑

系统会自动检测 XY 数据格式，条件：
1. 每行恰好包含 2 列数值
2. 两列都是有效的数值（支持负数和小数）
3. 至少 80% 的行符合格式
4. 支持多种分隔符（逗号、制表符、空格、分号）

检测成功后自动配置：
- 图表类型：XY 散点图
- X 轴字段：`x`
- Y 轴系列：`y`
- 分隔符：自动选择最佳分隔符

## 常见问题

### Q: XY 散点图和普通散点图有什么区别？

**A:**
- **普通散点图**：X 轴是数据点序号（0, 1, 2...），适合时间序列
- **XY 散点图**：X 轴是实际数据值，适合相关性分析和参数曲线

### Q: 如何显示多条曲线？

**A:** 使用多列数据格式：
```
x,y1,y2,y3
0,100,50,75
1,98,52,73
```
配置时添加多个系列（y1, y2, y3），它们会共享同一个 X 轴。

### Q: X 轴字段名必须是 "x" 吗？

**A:** 不是，可以是任意名称，但必须：
1. 在"基础"标签页的"X 轴字段"中指定
2. 与"分隔符"标签页中的字段名称匹配
3. 不要在数据系列中包含这个字段

### Q: 为什么图表不显示？

**A:** 检查以下几点：
1. 确保选择了"XY 散点图"类型
2. 确保设置了 X 轴字段
3. 确保 X 轴字段名与实际字段匹配
4. 确保至少有一个 Y 轴系列
5. 确保数据格式正确（两列或多列数值）

### Q: 可以实时更新吗？

**A:** 可以！XY 散点图支持实时数据流，新数据会自动添加到图表中。

## 技术细节

### 数据流程

1. **数据接收**：RTT 接收原始字节流
2. **文本解析**：转换为文本行
3. **字段解析**：根据分隔符拆分字段
4. **数据点创建**：`{ timestamp, values: { x: 10, y: 25 } }`
5. **图表渲染**：使用 x 作为 X 轴，y 作为 Y 轴

### 代码位置

- 类型定义：`src/lib/chartTypes.ts`
- 图表渲染：`src/components/rtt/RttChartViewer.tsx`
- 配置界面：`src/components/rtt/ChartConfigDialog.tsx`
- 智能检测：`src/lib/chartAutoConfig.ts`

### X 轴配置

在 Recharts 中，XY 散点图使用：
```tsx
<XAxis
  type="number"              // 数值类型
  dataKey={xAxisField}       // 使用指定字段
  label={{ value: xAxisField }}
/>
```

而普通散点图使用：
```tsx
<XAxis
  dataKey="index"            // 使用索引
  label={{ value: "数据点" }}
/>
```

## 示例代码

### 完整的嵌入式示例

```c
#include "SEGGER_RTT.h"
#include <math.h>

void send_xy_data(void) {
    for (int i = 0; i < 360; i++) {
        float angle = i * 3.14159 / 180.0;

        // 方法 1：李萨如图形
        int x = (int)(sin(angle) * 100);
        int y = (int)(sin(2 * angle) * 100);
        SEGGER_RTT_printf(0, "%d,%d\n", x, y);

        HAL_Delay(50);
    }
}
```

### 多系列示例

```c
void send_multi_series(void) {
    for (int i = 0; i < 360; i++) {
        float angle = i * 3.14159 / 180.0;

        int x = i;
        int sin_val = (int)(sin(angle) * 100);
        int cos_val = (int)(cos(angle) * 100);
        int tan_val = (int)(tan(angle) * 50);

        SEGGER_RTT_printf(0, "%d,%d,%d,%d\n", x, sin_val, cos_val, tan_val);

        HAL_Delay(50);
    }
}
```

## 总结

XY 散点图为 RTT 图表功能增加了强大的数据可视化能力，特别适合：
- ✅ 参数曲线绘制
- ✅ 相关性分析
- ✅ 李萨如图形
- ✅ 轨迹追踪
- ✅ 多变量关系展示

配合智能启用功能，使用起来非常简单！
